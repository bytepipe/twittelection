#!/usr/bin/perl

use strict;
use warnings;
use 5.010;
use lib 'lib';

use FindBin '$Bin';
use Template;

use TwittElection::Schema;

my $sch = TwittElection::Schema->get_schema;

my $tt = Template->new({
  ABSOLUTE     => 1,
  INCLUDE_PATH => "$Bin/../ttlib",
  OUTPUT_PATH  => "$Bin/../c",
  ENCODING     => 'utf8',
});

foreach my $c ($sch->resultset('Constituency')->all) {
  next unless $c->candidates->count;
  $tt->process('constituency.tt', { c => $c }, $c->list_name . '.html',
               {binmode => ':utf8'})
    or die $tt->error;
}

$tt->process('constituencies.tt', { constits => [ $sch->resultset('Constituency')->all ] },
             'index.html', {binmode => ':utf8'})
    or die $tt->error;
